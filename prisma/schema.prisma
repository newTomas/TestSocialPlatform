generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model User {
  id        String   @id @default(uuid(7))
  name      String
  email     String   @unique
  password  String
  createdAt DateTime @default(now())

  posts         Post[]
  refreshTokens RefreshToken[]
}

model Post {
  id        String    @id @default(uuid(7))
  text      String    @db.Text
  User      User      @relation(fields: [userId], references: [id])
  createdAt DateTime  @default(now())
  deletedAt DateTime?

  userId String

  @@index([deletedAt, userId]) // where deletedAt is NULL [and userId = $1]
}

model RefreshToken {
  id        BigInt   @id @default(autoincrement())
  token     String   @unique(length: 255) @db.Text // Current JWT with only userId in payload takes 192 chars
  User      User     @relation(fields: [userId], references: [id])
  expiredAt DateTime
  createdAt DateTime @default(now())

  userId String
}
